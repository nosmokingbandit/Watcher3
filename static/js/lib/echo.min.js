!function(a,b){"function"==typeof define&&define.amd?define(function(){return b(a)}):"object"==typeof exports?module.exports=b:a.echo=b(a)}(this,function(a){"use strict";var d,e,f,g,h,b={},c=function(){},i=function(a){return null===a.offsetParent},j=function(a,b){if(i(a))return!1;var c=a.getBoundingClientRect();return c.right>=b.l&&c.bottom>=b.t&&c.left<=b.r&&c.top<=b.b},k=function(){!g&&e||(clearTimeout(e),e=setTimeout(function(){b.render(),e=null},f))};return b.init=function(e){e=e||{};var i=e.offset||0,j=e.offsetVertical||i,l=e.offsetHorizontal||i,m=function(a,b){return parseInt(a||b,10)};d={t:m(e.offsetTop,j),b:m(e.offsetBottom,j),l:m(e.offsetLeft,l),r:m(e.offsetRight,l)},f=m(e.throttle,250),g=!1!==e.debounce,h=!!e.unload,c=e.callback||c,b.render(),document.addEventListener?(a.addEventListener("scroll",k,!1),a.addEventListener("load",k,!1)):(a.attachEvent("onscroll",k),a.attachEvent("onload",k))},b.render=function(e){for(var i,k,f=(e||document).querySelectorAll("[data-echo], [data-echo-background]"),g=f.length,l={l:0-d.l,t:0-d.t,b:(a.innerHeight||document.documentElement.clientHeight)+d.b,r:(a.innerWidth||document.documentElement.clientWidth)+d.r},m=0;m<g;m++)k=f[m],j(k,l)?(h&&k.setAttribute("data-echo-placeholder",k.src),null!==k.getAttribute("data-echo-background")?k.style.backgroundImage="url("+k.getAttribute("data-echo-background")+")":k.src!==(i=k.getAttribute("data-echo"))&&(k.src=i),h||(k.removeAttribute("data-echo"),k.removeAttribute("data-echo-background")),c(k,"load")):h&&(i=k.getAttribute("data-echo-placeholder"))&&(null!==k.getAttribute("data-echo-background")?k.style.backgroundImage="url("+i+")":k.src=i,k.removeAttribute("data-echo-placeholder"),c(k,"unload"));g||b.detach()},b.detach=function(){document.removeEventListener?a.removeEventListener("scroll",k):a.detachEvent("onscroll",k),clearTimeout(e)},b});